<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Secretarias - Zona 2</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .table-responsive {
            margin-top: 20px;
        }
        .btn-action {
            margin: 0 5px;
        }
        .categoria-header {
            background-color: #f8f9fa;
            font-weight: bold;
            text-transform: uppercase;
        }
        .categoria-aventureros {
            background-color: #fff3cd;
        }
        .categoria-conquistadores {
            background-color: #cfe2ff;
        }
        .categoria-guias {
            background-color: #d1e7dd;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container py-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <a href="index_staff.html" class="btn btn-secondary">
                <i class="fas fa-arrow-left me-2"></i>Volver al Menú
            </a>
            <h2>Registro de Secretarias</h2>
        </div>

        <!-- Formulario de Registro -->
        <div class="card mb-4">
            <div class="card-body">
                <form id="registroForm">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="nombreClub" class="form-label">Nombre del Club</label>
                            <select class="form-select" id="nombreClub" required>
                                <option value="PEQUEÑOS HÉROES DE LA FÉ">PEQUEÑOS HÉROES DE LA FÉ</option>
                                <option value="GEUEL">GEUEL Aventurero</option>
                                <option value="PEQUEÑOS PIONEROS">PEQUEÑOS PIONEROS</option>
                                <option value="GUARDIANES DE LA FÉ">GUARDIANES DE LA FÉ</option>
                                <option value="ENMANUEL">ENMANUEL</option>
                                <option value="HORMIGUITA LABORIOSAS">HORMIGUITA LABORIOSAS</option>
                                <option value="LUZ DE SILOE">LUZ DE SILOE</option>
                                <option value="SOLDADITOS DEL REY">SOLDADITOS DEL REY</option>
                                <option value="SOLDADITOS DE JESUS">SOLDADITOS DE JESUS</option>
                                <option value="SOLDADITOS DE LA FÉ">SOLDADITOS DE LA FÉ</option>
                                <option value="ESTRELLITAS DE JESÚS">ESTRELLITAS DE JESÚS</option>
                                <option value="OBEJITAS DE JESUS">OBEJITAS DE JESUS</option>
                                <option value="ARJE SION">ARJE SION</option>
                                <option value="ELYON">ELYON</option>
                                <option value="CONQUI-POWER">CONQUI-POWER</option>
                                <option value="JEMS">JEMS</option>
                                <option value="AMISADIA">AMISADAI</option>
                                <option value="JIREHT">JIREHT</option>

                                <option value="ESTRELLA DE ORIÓN">ESTRELLA DE ORIÓN</option>
                                <option value="MARANATHA">MARANATHA</option>
                                <option value="ANGELES DE HIERRO">ANGELES DE HIERRO</option>
                                <option value="QUERUBINES">QUERUBINES</option>
                                <option value="PIONEROS DEL NORTE">PIONEROS DEL NORTE</option>
                                <option value="GEUEL">GEUEL Conquistadores</option>
                                <option value="HÉROES DE LA FE">HÉROES DE LA FE</option>
                                <option value="CALEB">CALEB</option>
                                <option value="LEONES DE JUDA">LEONES DE JUDA</option>
                                <option value="SEAR JASUB">SEAR JASUB</option>
                                <option value="LA TRIBU DEL NORTE">LA TRIBU DEL NORTE</option>
                                <option value="EXCÉLSIOR">EXCÉLSIOR</option>
                                <option value="LEGENDARY">LEGENDARY</option>
                                <option value="SIRIUS">SIRIUS</option>
                                <option value="UZIEL">UZIEL</option>
                                <option value="BETELGEUSE">BETELGEUSE</option>
                                <option value="PIONEROS">PIONEROS</option>
                                <option value="ALPHA CENTAURI">ALPHA CENTAURI</option>
                                <option value="GEUEL">GEUEL EGM</option>
                                <option value="DINAMUS">DINAMUS</option>
                                <option value="ÁNGELES DE ORIÓN">ÁNGELES DE ORIÓN</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="categoria" class="form-label">Categoría</label>
                            <select class="form-select" id="categoria" required>
                                <option value="">Seleccione una categoría</option>
                                <option value="Conquistadores">Escuela de Guías</option>
                                <option value="Conquistadores">Conquistadores</option>
                                <option value="Aventureros">Aventureros</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="secretaria" class="form-label">Secretaria</label>
                            <input type="text" class="form-control" id="secretaria" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="telefono" class="form-label">Teléfono</label>
                            <input type="tel" class="form-control" id="telefono" required pattern="[0-9]{10}" placeholder="Ej: 8091234567">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="iglesia" class="form-label">Iglesia</label>
                            <select class="form-select" id="iglesia" required>
                                <option value="">Seleccione una iglesia</option>
                                <option value="Sión">Sión</option>
                                <option value="Adonai">Adonai</option>
                                <option value="Ebenezer">Ebenezer</option>
                                <option value="Cordero de Dios">Cordero de Dios</option>
                                <option value="Maranatha, Gurabo">Maranatha, Gurabo</option>
                                <option value="Gurabo">Gurabo</option>
                                <option value="Fuente de Vida">Fuente de Vida</option>
                                <option value="Fuente de Salvación">Fuente de Salvación</option>
                                <option value="Central Jábaba">Central Jábaba</option>
                                <option value="Rosa de Sarón">Rosa de Sarón</option>
                                <option value="La Fé">La Fé</option>
                                <option value="Reconciliación">Reconciliación</option>
                                <option value="Rayo de Luz">Rayo de Luz</option>
                                <option value="Central Moca">Central Moca</option>
                                <option value="Villa Trina">Villa Trina</option>
                                <option value="San Victor">San Victor</option>
                            </select>
                        </div>
                    </div>
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary">Registrar</button>
                        <button type="button" class="btn btn-success ms-2" onclick="exportarPDF()"><i class="fas fa-file-pdf"></i> Exportar a PDF</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Tabla de Registros -->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Club</th>
                                <th>Categoría</th>
                                <th>Secretaria</th>
                                <th>Teléfono</th>
                                <th>Iglesia</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="registrosTabla"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Edición -->
    <div class="modal fade" id="editModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Editar Registro</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editForm">
                        <input type="hidden" id="editId">
                        <div class="mb-3">
                            <label for="editNombreClub" class="form-label">Nombre del Club</label>
                            <select class="form-select" id="editNombreClub" required>
                                <option value="">Seleccione un club</option>
                                <option value="PEQUEÑOS HÉROES DE LA FÉ">PEQUEÑOS HÉROES DE LA FÉ</option>
                                <option value="GEUEL">GEUEL</option>
                                <option value="PEQUEÑOS PIONEROS">PEQUEÑOS PIONEROS</option>
                                <option value="GUARDIANES DE LA FÉ">GUARDIANES DE LA FÉ</option>
                                <option value="ENMANUEL">ENMANUEL</option>
                                <option value="HORMIGUITA LABORIOSAS">HORMIGUITA LABORIOSAS</option>
                                <option value="LUZ DE SILOE">LUZ DE SILOE</option>
                                <option value="SOLDADITOS DEL REY">SOLDADITOS DEL REY</option>
                                <option value="SOLDADITOS DE JESUS">SOLDADITOS DE JESUS</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="editCategoria" class="form-label">Categoría</label>
                            <select class="form-select" id="editCategoria" required>
                                <option value="">Seleccione una categoría</option>
                                <option value="Conquistadores">Conquistadores</option>
                                <option value="Aventureros">Aventureros</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="editSecretaria" class="form-label">Secretaria</label>
                            <input type="text" class="form-control" id="editSecretaria" required>
                        </div>
                        <div class="mb-3">
                            <label for="editTelefono" class="form-label">Teléfono</label>
                            <input type="tel" class="form-control" id="editTelefono" required pattern="[0-9]{10}">
                        </div>
                        <div class="mb-3">
                            <label for="editIglesia" class="form-label">Iglesia</label>
                            <select class="form-select" id="editIglesia" required>
                                <option value="">Seleccione una iglesia</option>
                                <option value="Sión">Sión</option>
                                <option value="Adonai">Adonai</option>
                                <option value="Ebenezer">Ebenezer</option>
                                <option value="Cordero de Dios">Cordero de Dios</option>
                                <option value="Maranatha">Maranatha</option>
                                <option value="Gurabo">Gurabo</option>
                                <option value="Fuente de Vida">Fuente de Vida</option>
                                <option value="Fuente de Salvación">Fuente de Salvación</option>
                                <option value="Central Jábaba">Central Jábaba</option>
                                <option value="Rosa de Sarón">Rosa de Sarón</option>
                                <option value="La Fé">La Fé</option>
                                <option value="Reconciliación">Reconciliación</option>
                                <option value="Rayo de Luz">Rayo de Luz</option>
                                <option value="Central Moca">Central Moca</option>
                                <option value="Villa Trina">Villa Trina</option>
                                <option value="San Victor">San Victor</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="guardarEdicion()">Guardar Cambios</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script>
        let registros = JSON.parse(localStorage.getItem('registrosSecretarias')) || [];

        // Función para generar ID único
        function generarId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Manejar envío del formulario
        document.getElementById('registroForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const registro = {
                id: generarId(),
                nombreClub: document.getElementById('nombreClub').value,
                categoria: document.getElementById('categoria').value,
                secretaria: document.getElementById('secretaria').value,
                telefono: document.getElementById('telefono').value,
                iglesia: document.getElementById('iglesia').value
            };
            registros.push(registro);
            localStorage.setItem('registrosSecretarias', JSON.stringify(registros));
            this.reset();
            actualizarTabla();
        });

        // Función para actualizar tabla
        function actualizarTabla() {
            const tabla = document.getElementById('registrosTabla');
            tabla.innerHTML = '';
            
            // Agrupar registros por categoría
            const categorias = {
                'Escuela de Guías': [],
                'Conquistadores': [],
                'Aventureros': []
            };
            
            registros.forEach(registro => {
                if (categorias.hasOwnProperty(registro.categoria)) {
                    categorias[registro.categoria].push(registro);
                }
            });
            
            // Mostrar registros por categoría
            Object.entries(categorias).forEach(([categoria, registrosCategoria]) => {
                if (registrosCategoria.length > 0) {
                    // Agregar encabezado de categoría
                    const filaCategoria = document.createElement('tr');
                    filaCategoria.className = 'categoria-header';
                    filaCategoria.innerHTML = `<td colspan="6">${categoria} (${registrosCategoria.length})</td>`;
                    tabla.appendChild(filaCategoria);
                    
                    // Agregar registros de la categoría
                    registrosCategoria.forEach(registro => {
                        const fila = document.createElement('tr');
                        fila.className = `categoria-${categoria.toLowerCase().replace('escuela de ', '')}`;
                        fila.innerHTML = `
                            <td>${registro.nombreClub}</td>
                            <td>${registro.categoria}</td>
                            <td>${registro.secretaria}</td>
                            <td>${registro.telefono}</td>
                            <td>${registro.iglesia}</td>
                            <td>
                                <button class="btn btn-sm btn-primary btn-action" onclick="editarRegistro('${registro.id}')"><i class="fas fa-edit"></i></button>
                                <button class="btn btn-sm btn-danger btn-action" onclick="eliminarRegistro('${registro.id}')"><i class="fas fa-trash"></i></button>
                            </td>
                        `;
                        tabla.appendChild(fila);
                    });
                }
            });
        }

        // Función para editar registro
        function editarRegistro(id) {
            const registro = registros.find(r => r.id === id);
            document.getElementById('editId').value = registro.id;
            document.getElementById('editNombreClub').value = registro.nombreClub;
            document.getElementById('editCategoria').value = registro.categoria;
            document.getElementById('editSecretaria').value = registro.secretaria;
            document.getElementById('editTelefono').value = registro.telefono;
            document.getElementById('editIglesia').value = registro.iglesia;
            new bootstrap.Modal(document.getElementById('editModal')).show();
        }

        // Función para guardar edición
        function guardarEdicion() {
            const id = document.getElementById('editId').value;
            const index = registros.findIndex(r => r.id === id);
            if (index !== -1) {
                registros[index] = {
                    id: id,
                    nombreClub: document.getElementById('editNombreClub').value,
                    categoria: document.getElementById('editCategoria').value,
                    secretaria: document.getElementById('editSecretaria').value,
                    telefono: document.getElementById('editTelefono').value,
                    iglesia: document.getElementById('editIglesia').value
                };
                localStorage.setItem('registrosSecretarias', JSON.stringify(registros));
                actualizarTabla();
                bootstrap.Modal.getInstance(document.getElementById('editModal')).hide();
            }
        }

        // Función para eliminar registro
        function eliminarRegistro(id) {
            if (confirm('¿Está seguro de eliminar este registro?')) {
                registros = registros.filter(r => r.id !== id);
                localStorage.setItem('registrosSecretarias', JSON.stringify(registros));
                actualizarTabla();
            }
        }

        // Función para exportar a PDF
        function exportarPDF() {
            window.jsPDF = window.jspdf.jsPDF;
            const doc = new jsPDF();
            
            // Configuración del documento
            doc.setFontSize(16);
            doc.text('Registro de Secretarias - Zona 2', 14, 20);
            doc.setFontSize(10);
            doc.text('Fecha de generación: ' + new Date().toLocaleDateString(), 14, 30);
            
            let startY = 40;
            const categorias = {
                'Escuela de Guías': [],
                'Conquistadores': [],
                'Aventureros': []
            };
            
            // Agrupar registros por categoría
            registros.forEach(registro => {
                if (categorias.hasOwnProperty(registro.categoria)) {
                    categorias[registro.categoria].push(registro);
                }
            });
            
            // Generar tablas por categoría
            Object.entries(categorias).forEach(([categoria, registrosCategoria]) => {
                if (registrosCategoria.length > 0) {
                    // Agregar título de la categoría
                    doc.setFontSize(12);
                    doc.text(`${categoria} (${registrosCategoria.length})`, 14, startY);
                    
                    // Configurar la tabla
                    const headers = [['Club', 'Secretaria', 'Teléfono', 'Iglesia']];
                    const data = registrosCategoria.map(registro => [
                        registro.nombreClub,
                        registro.secretaria,
                        registro.telefono,
                        registro.iglesia
                    ]);
                    
                    // Generar tabla
                    doc.autoTable({
                        head: headers,
                        body: data,
                        startY: startY + 5,
                        theme: 'grid',
                        headStyles: { fillColor: [52, 152, 219] },
                        margin: { top: 10 }
                    });
                    
                    startY = doc.lastAutoTable.finalY + 20;
                }
            });
            
            // Guardar el PDF
            doc.save('registro-secretarias.pdf');
        }
        
        // Cargar registros al iniciar
        actualizarTabla();
    </script>
</body>
</html>